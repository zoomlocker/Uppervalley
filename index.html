<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UVDS Leachate Basin Capacity</title>
    <link rel="stylesheet" href="styles.css">
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
</head>
<body>
    <div class="container">
        <h1>UVDS Leachate Basin Capacity</h1>

        <div class="input-section">
            <label for="depth">Enter Depth Gauge Reading:</label>
            <input type="text" id="depth">
            <button onclick="calculate()">Calculate</button>
        </div>

        <div id="results">
            <div class="result-section">
                <h2>Cumulative Volume</h2>
                <div class="volume-display" id="cumulativeVolumeCubic">0 cu.ft.</div>
                <div class="gallon-display" id="cumulativeVolumeGallon">0 gallons</div>
            </div>
            <div class="result-section">
                <h2>Remaining Capacity</h2>
                <div class="volume-display" id="remainingVolumeCubic">0 cu.ft.</div>
                <div class="gallon-display" id="remainingVolumeGallon">0 gallons</div>
            </div>
        </div>

        <div class="chart-container" id="pieChart"></div>

        <div class="footer-note">
            Review & Validation: Before making critical decisions based on this data, it's advisable to cross-check and validate the information, especially if there have been changes to the pond structure or topography since the last CAD update.
        </div>
    </div>

    <script src="app.js"></script>

    <script>
        const dataPoints = [
            { depth: 0, cumulativeVol: 0 },
            { depth: 2, cumulativeVol: 92560 },
            { depth: 4, cumulativeVol: 194773 },
            { depth: 6, cumulativeVol: 306949 },
            { depth: 8, cumulativeVol: 429544 },
            { depth: 10, cumulativeVol: 563060 },
            { depth: 12, cumulativeVol: 707822 },
            { depth: 14, cumulativeVol: 864196 },
            { depth: 14.5, cumulativeVol: 1032685 }
        ];

        let pieChart = null; 

        function calculate() {
            const inputDepth = parseFloat(document.getElementById('depthInput').value);
            const maxDepth = dataPoints[dataPoints.length - 1].depth;
            const maxVolume = dataPoints[dataPoints.length - 1].cumulativeVol;
            let interpolatedVolume = 0;

            if (inputDepth <= maxDepth && inputDepth >= 0) {
                for (let i = 1; i < dataPoints.length; i++) {
                    if (inputDepth <= dataPoints[i].depth) {
                        interpolatedVolume = dataPoints[i - 1].cumulativeVol + ((inputDepth - dataPoints[i - 1].depth) / (dataPoints[i].depth - dataPoints[i - 1].depth)) * (dataPoints[i].cumulativeVol - dataPoints[i - 1].cumulativeVol);
                        break;
                    }
                }
            }

            const remainingCapacityCubic = maxVolume - interpolatedVolume;
            const remainingCapacityGallon = remainingCapacityCubic * 7.48052;

            document.getElementById('cumulativeVolumeCubic').textContent = `${Math.round(interpolatedVolume).toLocaleString()} cu.ft.`;
            document.getElementById('cumulativeVolumeGallon').textContent = `${Math.round(interpolatedVolume * 7.48052).toLocaleString()} gallons`;
            document.getElementById('remainingCapacityCubic').textContent = `${Math.round(remainingCapacityCubic).toLocaleString()} cu.ft.`;
            document.getElementById('remainingCapacityGallon').textContent = `${Math.round(remainingCapacityGallon).toLocaleString()} gallons`;

            drawPieChart(Math.round(interpolatedVolume * 7.48052), Math.round(remainingCapacityGallon));
        }

        function drawPieChart(used, remaining) {
            const ctx = document.getElementById('volumeChart').getContext('2d');
            
            if (pieChart) {
                pieChart.destroy();
            }

            pieChart = new Chart(ctx, {
                type: 'pie',
                data: {
                    labels: ['Used Volume', 'Remaining Capacity'],
                    datasets: [{
                        data: [used, remaining],
                        backgroundColor: ['#3498db', '#e74c3c']
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false
                }
            });
        }
    </script>
</body>
</html>
